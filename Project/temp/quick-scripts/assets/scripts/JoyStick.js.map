{"version":3,"sources":["JoyStick.js"],"names":["cc","Class","extends","Component","properties","Stick","type","Node","default","ShieldBtn","ShieldPrefab","Prefab","Player","Max_r","Speed","generateShield","newShield","active","setTimeout","bind","start","x","y","dir","v2","instantiate","node","parent","addChild","on","EventType","TOUCH_START","e","w_pos","getLocation","pos","convertToNodeSpaceAR","len","mag","setPosition","TOUCH_MOVE","TOUCH_END","TOUCH_CANCEL","update","dt","accelX","accelY","player","getComponents","Math","sqrt","pow","speedX","speedY","r","atan2","degree","PI","rotation"],"mappings":"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","file":"JoyStick.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        Stick: {\r\n            type: cc.Node,\r\n            default: null,\r\n        },\r\n        ShieldBtn: {\r\n            type: cc.Node,\r\n            default: null,\r\n        },\r\n        ShieldPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        Player: {\r\n            type: cc.Node,\r\n            default: null,\r\n        },\r\n        Max_r: 200,\r\n        Speed: 600,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {},\r\n\r\n    generateShield: function () {\r\n        this.newShield.active = true\r\n\r\n        setTimeout(function () {\r\n            this.active = false\r\n        }.bind(this.newShield), 3000);\r\n    },\r\n\r\n    start() {\r\n        this.Stick.x = 0;\r\n        this.Stick.y = 0;\r\n        this.dir = cc.v2(0, 0);\r\n\r\n        this.newShield = cc.instantiate(this.ShieldPrefab)\r\n        this.node.parent.addChild(this.newShield)\r\n        this.newShield.x = this.Player.x\r\n        this.newShield.y = this.Player.y\r\n\r\n        this.newShield.active = false\r\n\r\n\r\n        this.Stick.on(cc.Node.EventType.TOUCH_START, function (e) {\r\n            var w_pos = e.getLocation();\r\n            var pos = this.node.convertToNodeSpaceAR(w_pos);\r\n            var len = pos.mag(); //获取向量长度\r\n            this.dir.x = pos.x / len;\r\n            this.dir.y = pos.y / len;\r\n            if (len > this.Max_r) {\r\n                pos.x = this.Max_r * pos.x / len;\r\n                pos.y = this.Max_r * pos.y / len;\r\n            }\r\n            this.Stick.setPosition(pos);\r\n        }, this);\r\n\r\n        this.ShieldBtn.on(cc.Node.EventType.TOUCH_START, function (e) {\r\n            this.generateShield()\r\n        }, this);\r\n\r\n        this.Stick.on(cc.Node.EventType.TOUCH_MOVE, function (e) {\r\n            var w_pos = e.getLocation();\r\n            var pos = this.node.convertToNodeSpaceAR(w_pos);\r\n            var len = pos.mag();\r\n            this.dir.x = pos.x / len;\r\n            this.dir.y = pos.y / len;\r\n            if (len > this.Max_r) {\r\n                pos.x = this.Max_r * pos.x / len;\r\n                pos.y = this.Max_r * pos.y / len;\r\n            }\r\n            this.Stick.setPosition(pos);\r\n        }, this);\r\n\r\n        this.Stick.on(cc.Node.EventType.TOUCH_END, function (e) {\r\n            this.Stick.setPosition(cc.v2(0, 0));\r\n            this.dir = cc.v2(0, 0);\r\n        }, this);\r\n\r\n        this.Stick.on(cc.Node.EventType.TOUCH_CANCEL, function (e) {\r\n            this.Stick.setPosition(cc.v2(0, 0));\r\n            this.dir = cc.v2(0, 0);\r\n        }, this);\r\n    },\r\n\r\n    update(dt) {\r\n        this.newShield.x = this.Player.x\r\n        this.newShield.y = this.Player.y\r\n\r\n        if (this.dir.mag() < 0.5) {\r\n            return;\r\n        }\r\n\r\n\r\n        var accelX = this.dir.x * this.Speed;\r\n        var accelY = this.dir.y * this.Speed;\r\n        var player = this.Player.getComponents(\"Player\")[0];\r\n        if(Math.sqrt(Math.pow(player.speedX, 2) + Math.pow(player.speedY, 2)) < this.Speed)\r\n        {\r\n           \r\n            player.speedX += accelX * dt;\r\n            player.speedY += accelY * dt;\r\n        }\r\n        \r\n        //方向计算\r\n        var r = Math.atan2(this.dir.y, this.dir.x);\r\n        var degree = r * 180 / (Math.PI);\r\n        degree = 360 - degree + 90;\r\n        this.Player.rotation = degree;\r\n    },\r\n});"]}