{"version":3,"sources":["JoyStick.js"],"names":["cc","Class","extends","Component","properties","Stick","type","Node","default","Ring","ShieldBtn","ShieldLabel","Label","ShieldPrefab","Prefab","Player","Max_r","ShieldDuartion","onLoad","shieldLabel","getComponent","player","getComponents","Speed","speed","string","shield","x","y","dir","v2","newShield","instantiate","node","parent","addChild","name","active","initEvent","on","EventType","TOUCH_START","e","w_pos","getLocation","pos","convertToNodeSpaceAR","len","mag","setPosition","generateShield","TOUCH_MOVE","TOUCH_END","TOUCH_CANCEL","setTimeout","bind","start","updatePos","dt","updateDir","r","Math","atan2","degree","PI","rotation","update"],"mappings":";;;;;;AAAA;;;;AAIAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,eAAO;AACHC,kBAAMN,GAAGO,IADN;AAEHC,qBAAS;AAFN,SADC;AAKRC,cAAK;AACDH,kBAAMN,GAAGO,IADR;AAEDC,qBAAS;AAFR,SALG;AASRE,mBAAW;AACPJ,kBAAMN,GAAGO,IADF;AAEPC,qBAAS;AAFF,SATH;AAaRG,qBAAa;AACTL,kBAAMN,GAAGY,KADA;AAETJ,qBAAS;AAFA,SAbL;AAiBRK,sBAAc;AACVL,qBAAS,IADC;AAEVF,kBAAMN,GAAGc;AAFC,SAjBN;AAqBRC,gBAAQ;AACJT,kBAAMN,GAAGO,IADL;AAEJC,qBAAS;AAFL,SArBA;AAyBRQ,eAAO,GAzBC;AA0BRC,wBAAgB;AA1BR,KAHP;;AAgCL;;;;AAIAC,UApCK,oBAoCK;AACN,aAAKC,WAAL,GAAmB,KAAKR,WAAL,CAAiBS,YAAjB,CAA8BpB,GAAGY,KAAjC,CAAnB;AACA,aAAKS,MAAL,GAAc,KAAKN,MAAL,CAAYO,aAAZ,CAA0B,QAA1B,EAAoC,CAApC,CAAd;AACA,aAAKC,KAAL,GAAa,KAAKF,MAAL,CAAYG,KAAzB;AACA,aAAKL,WAAL,CAAiBM,MAAjB,GAA0B,KAAKJ,MAAL,CAAYK,MAAtC;;AAEA,aAAKrB,KAAL,CAAWsB,CAAX,GAAe,CAAf;AACA,aAAKtB,KAAL,CAAWuB,CAAX,GAAe,CAAf;AACA,aAAKC,GAAL,GAAW7B,GAAG8B,EAAH,CAAM,CAAN,EAAS,CAAT,CAAX;;AAEA,aAAKC,SAAL,GAAiB/B,GAAGgC,WAAH,CAAe,KAAKnB,YAApB,CAAjB;AACA,aAAKoB,IAAL,CAAUC,MAAV,CAAiBC,QAAjB,CAA0B,KAAKJ,SAA/B;AACA,aAAKA,SAAL,CAAeJ,CAAf,GAAmB,KAAKZ,MAAL,CAAYY,CAA/B;AACA,aAAKI,SAAL,CAAeH,CAAf,GAAmB,KAAKb,MAAL,CAAYa,CAA/B;;AAEA,YAAI,KAAKK,IAAL,CAAUG,IAAV,KAAmB,WAAvB,EAAoC;AAChC,iBAAKL,SAAL,CAAeK,IAAf,GAAsB,YAAtB;AACH,SAFD,MAEO;AACH,iBAAKL,SAAL,CAAeK,IAAf,GAAsB,aAAtB;AACH;;AAED,aAAKL,SAAL,CAAeM,MAAf,GAAwB,KAAxB;;AAEA,aAAKC,SAAL;AAEH,KA7DI;;;AAgEL;;;;AAIAA,aApEK,uBAoEQ;AACT,aAAK7B,IAAL,CAAU8B,EAAV,CAAavC,GAAGO,IAAH,CAAQiC,SAAR,CAAkBC,WAA/B,EAA4C,UAAUC,CAAV,EAAa;AACrD,gBAAIC,QAAQD,EAAEE,WAAF,EAAZ;AACA,iBAAKC,GAAL,GAAW,KAAKZ,IAAL,CAAUa,oBAAV,CAA+BH,KAA/B,CAAX;AACA,gBAAII,MAAM,KAAKF,GAAL,CAASG,GAAT,EAAV,CAHqD,CAG3B;AAC1B,iBAAKnB,GAAL,CAASF,CAAT,GAAa,KAAKkB,GAAL,CAASlB,CAAT,GAAaoB,GAA1B;AACA,iBAAKlB,GAAL,CAASD,CAAT,GAAa,KAAKiB,GAAL,CAASjB,CAAT,GAAamB,GAA1B;AACA,gBAAIA,MAAM,KAAK/B,KAAf,EAAsB;AAClB,qBAAK6B,GAAL,CAASlB,CAAT,GAAa,KAAKX,KAAL,GAAa,KAAK6B,GAAL,CAASlB,CAAtB,GAA0BoB,GAAvC;AACA,qBAAKF,GAAL,CAASjB,CAAT,GAAa,KAAKZ,KAAL,GAAa,KAAK6B,GAAL,CAASjB,CAAtB,GAA0BmB,GAAvC;AACH;AACD,iBAAK1C,KAAL,CAAW4C,WAAX,CAAuB,KAAKJ,GAA5B;AACH,SAXD,EAWG,IAXH;;AAaA,aAAKnC,SAAL,CAAe6B,EAAf,CAAkBvC,GAAGO,IAAH,CAAQiC,SAAR,CAAkBC,WAApC,EAAiD,UAAUC,CAAV,EAAa;AAC1D,iBAAKQ,cAAL;AACH,SAFD,EAEG,IAFH;;AAIA,aAAKzC,IAAL,CAAU8B,EAAV,CAAavC,GAAGO,IAAH,CAAQiC,SAAR,CAAkBW,UAA/B,EAA2C,UAAUT,CAAV,EAAa;AACpD,gBAAIC,QAAQD,EAAEE,WAAF,EAAZ;AACA,iBAAKC,GAAL,GAAW,KAAKZ,IAAL,CAAUa,oBAAV,CAA+BH,KAA/B,CAAX;AACA,gBAAII,MAAM,KAAKF,GAAL,CAASG,GAAT,EAAV;AACA,iBAAKnB,GAAL,CAASF,CAAT,GAAa,KAAKkB,GAAL,CAASlB,CAAT,GAAaoB,GAA1B;AACA,iBAAKlB,GAAL,CAASD,CAAT,GAAa,KAAKiB,GAAL,CAASjB,CAAT,GAAamB,GAA1B;AACA,gBAAIA,MAAM,KAAK/B,KAAf,EAAsB;AAClB,qBAAK6B,GAAL,CAASlB,CAAT,GAAa,KAAKX,KAAL,GAAa,KAAK6B,GAAL,CAASlB,CAAtB,GAA0BoB,GAAvC;AACA,qBAAKF,GAAL,CAASjB,CAAT,GAAa,KAAKZ,KAAL,GAAa,KAAK6B,GAAL,CAASjB,CAAtB,GAA0BmB,GAAvC;AACH;AACD,iBAAK1C,KAAL,CAAW4C,WAAX,CAAuB,KAAKJ,GAA5B;AACH,SAXD,EAWG,IAXH;;AAaA,aAAKpC,IAAL,CAAU8B,EAAV,CAAavC,GAAGO,IAAH,CAAQiC,SAAR,CAAkBY,SAA/B,EAA0C,UAAUV,CAAV,EAAa;AACnD,iBAAKrC,KAAL,CAAW4C,WAAX,CAAuBjD,GAAG8B,EAAH,CAAM,CAAN,EAAS,CAAT,CAAvB;AACA,iBAAKD,GAAL,GAAW7B,GAAG8B,EAAH,CAAM,CAAN,EAAS,CAAT,CAAX;AACH,SAHD,EAGG,IAHH;;AAKA,aAAKrB,IAAL,CAAU8B,EAAV,CAAavC,GAAGO,IAAH,CAAQiC,SAAR,CAAkBa,YAA/B,EAA6C,UAAUX,CAAV,EAAa;AACtD,iBAAKrC,KAAL,CAAW4C,WAAX,CAAuBjD,GAAG8B,EAAH,CAAM,CAAN,EAAS,CAAT,CAAvB;AACA,iBAAKD,GAAL,GAAW7B,GAAG8B,EAAH,CAAM,CAAN,EAAS,CAAT,CAAX;AACH,SAHD,EAGG,IAHH;AAIH,KA5GI;;;AA+GL;;;;AAIAoB,kBAnHK,4BAmHa;AACd,YAAG,KAAK7B,MAAL,CAAYK,MAAZ,IAAsB,CAAzB,EAA2B;AACvB;AACH;;AAED,aAAKL,MAAL,CAAYK,MAAZ;AACA,aAAKP,WAAL,CAAiBM,MAAjB,GAA0B,KAAKJ,MAAL,CAAYK,MAAtC;;AAEA,aAAKK,SAAL,CAAeM,MAAf,GAAwB,IAAxB;;AAEAiB,mBAAW,YAAY;AACnB,iBAAKjB,MAAL,GAAc,KAAd;AACH,SAFU,CAETkB,IAFS,CAEJ,KAAKxB,SAFD,CAAX,EAEwB,OAAO,KAAKd,cAFpC;AAGH,KAhII;AAkILuC,SAlIK,mBAkIG,CAEP,CApII;;;AAsIL;;;;AAIAC,aA1IK,qBA0IMC,EA1IN,EA0IU;AACX,YAAI,KAAK3B,SAAL,KAAmB,IAAvB,EACA;AACI,iBAAKA,SAAL,CAAeJ,CAAf,GAAmB,KAAKZ,MAAL,CAAYY,CAA/B;AACA,iBAAKI,SAAL,CAAeH,CAAf,GAAmB,KAAKb,MAAL,CAAYa,CAA/B;AACH;;AAED,YAAI,KAAKC,GAAL,CAASmB,GAAT,KAAiB,GAArB,EAA0B;AACtB;AACH;;AAGD,aAAKjC,MAAL,CAAYY,CAAZ,IAAiB,KAAKJ,KAAL,GAAa,KAAKM,GAAL,CAASF,CAAtB,GAA0B,KAAKkB,GAAL,CAASG,GAAT,EAA1B,IAA4C,KAAKnB,GAAL,CAASmB,GAAT,KAAiB,KAAKhC,KAAlE,CAAjB;AACA,aAAKD,MAAL,CAAYa,CAAZ,IAAiB,KAAKL,KAAL,GAAa,KAAKM,GAAL,CAASD,CAAtB,GAA0B,KAAKiB,GAAL,CAASG,GAAT,EAA1B,IAA4C,KAAKnB,GAAL,CAASmB,GAAT,KAAiB,KAAKhC,KAAlE,CAAjB;AACH,KAxJI;;;AA0JL;;;;AAIA2C,aA9JK,uBA8JQ;AACT,YAAIC,IAAIC,KAAKC,KAAL,CAAW,KAAKjC,GAAL,CAASD,CAApB,EAAuB,KAAKC,GAAL,CAASF,CAAhC,CAAR;AACA,YAAIoC,SAASH,IAAI,GAAJ,GAAWC,KAAKG,EAA7B;AACAD,iBAAS,MAAMA,MAAN,GAAe,EAAxB;AACA,aAAKhD,MAAL,CAAYkD,QAAZ,GAAuBF,MAAvB;AACH,KAnKI;AAqKLG,UArKK,kBAqKER,EArKF,EAqKM;AACP,aAAKD,SAAL,CAAeC,EAAf;AACA,aAAKC,SAAL;AACH;AAxKI,CAAT","file":"JoyStick.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\Game","sourcesContent":["/*\n * 控制杆脚本\n */\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        Stick: {\n            type: cc.Node,\n            default: null,\n        },\n        Ring:{\n            type: cc.Node,\n            default: null,\n        },\n        ShieldBtn: {\n            type: cc.Node,\n            default: null,\n        },\n        ShieldLabel: {\n            type: cc.Label,\n            default: null,\n        },\n        ShieldPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        Player: {\n            type: cc.Node,\n            default: null,\n        },\n        Max_r: 100,\n        ShieldDuartion: 5,\n    },\n\n    /*\n     * 初始化函数\n     * 功能：初始化脚本的设定\n     */\n    onLoad () {\n        this.shieldLabel = this.ShieldLabel.getComponent(cc.Label)\n        this.player = this.Player.getComponents(\"Player\")[0]\n        this.Speed = this.player.speed\n        this.shieldLabel.string = this.player.shield\n\n        this.Stick.x = 0 \n        this.Stick.y = 0 \n        this.dir = cc.v2(0, 0) \n\n        this.newShield = cc.instantiate(this.ShieldPrefab)\n        this.node.parent.addChild(this.newShield)\n        this.newShield.x = this.Player.x\n        this.newShield.y = this.Player.y\n\n        if (this.node.name === 'stickLeft') {\n            this.newShield.name = 'shieldLeft'\n        } else {\n            this.newShield.name = 'shieldRight'\n        }\n\n        this.newShield.active = false\n\n        this.initEvent()\n        \n    },\n\n\n    /*\n     * 初始化回调函数\n     * 功能：初始化各个组件的回调函数\n     */\n    initEvent () {\n        this.Ring.on(cc.Node.EventType.TOUCH_START, function (e) {\n            var w_pos = e.getLocation() \n            this.pos = this.node.convertToNodeSpaceAR(w_pos) \n            var len = this.pos.mag()  //获取向量长度\n            this.dir.x = this.pos.x / len \n            this.dir.y = this.pos.y / len \n            if (len > this.Max_r) {\n                this.pos.x = this.Max_r * this.pos.x / len \n                this.pos.y = this.Max_r * this.pos.y / len \n            }\n            this.Stick.setPosition(this.pos) \n        }, this) \n\n        this.ShieldBtn.on(cc.Node.EventType.TOUCH_START, function (e) {\n            this.generateShield()\n        }, this) \n\n        this.Ring.on(cc.Node.EventType.TOUCH_MOVE, function (e) {\n            var w_pos = e.getLocation() \n            this.pos = this.node.convertToNodeSpaceAR(w_pos) \n            var len = this.pos.mag() \n            this.dir.x = this.pos.x / len \n            this.dir.y = this.pos.y / len \n            if (len > this.Max_r) {\n                this.pos.x = this.Max_r * this.pos.x / len \n                this.pos.y = this.Max_r * this.pos.y / len \n            }\n            this.Stick.setPosition(this.pos) \n        }, this) \n\n        this.Ring.on(cc.Node.EventType.TOUCH_END, function (e) {\n            this.Stick.setPosition(cc.v2(0, 0)) \n            this.dir = cc.v2(0, 0) \n        }, this) \n\n        this.Ring.on(cc.Node.EventType.TOUCH_CANCEL, function (e) {\n            this.Stick.setPosition(cc.v2(0, 0)) \n            this.dir = cc.v2(0, 0) \n        }, this) \n    },\n\n\n    /*\n     * 护盾生成函数\n     * 功能：为主角生成一个护盾\n     */\n    generateShield () {\n        if(this.player.shield <= 0){\n            return\n        }\n\n        this.player.shield--\n        this.shieldLabel.string = this.player.shield\n\n        this.newShield.active = true\n\n        setTimeout(function () {\n            this.active = false\n        }.bind(this.newShield), 1000 * this.ShieldDuartion) \n    },\n\n    start() {\n        \n    },\n\n    /*\n     * 位置更新函数\n     * 功能：更新主角和护盾的位置\n     */\n    updatePos (dt) {\n        if (this.newShield !== null)\n        {\n            this.newShield.x = this.Player.x\n            this.newShield.y = this.Player.y\n        }\n\n        if (this.dir.mag() < 0.5) {\n            return\n        }\n\n\n        this.Player.x += this.Speed * this.dir.x * this.pos.mag() / (this.dir.mag() * this.Max_r)\n        this.Player.y += this.Speed * this.dir.y * this.pos.mag() / (this.dir.mag() * this.Max_r)\n    },\n\n    /*\n     * 方向更新函数\n     * 功能：更新主角的旋转方向\n     */\n    updateDir () {\n        var r = Math.atan2(this.dir.y, this.dir.x) \n        var degree = r * 180 / (Math.PI) \n        degree = 360 - degree + 90 \n        this.Player.rotation = degree \n    },\n\n    update(dt) {\n        this.updatePos(dt)\n        this.updateDir()    \n    },\n});"]}