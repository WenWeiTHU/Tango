{"version":3,"sources":["JoyStick.js"],"names":["cc","Class","extends","Component","properties","Stick","type","Node","default","ShieldBtn","ShieldLabel","Label","ShieldPrefab","Prefab","Player","Max_r","ShieldDuartion","generateShield","player","shield","shieldLabel","string","newShield","active","setTimeout","bind","start","getComponent","getComponents","Speed","speed","x","y","dir","v2","instantiate","node","parent","addChild","name","on","EventType","TOUCH_START","e","w_pos","getLocation","pos","convertToNodeSpaceAR","len","mag","setPosition","TOUCH_MOVE","TOUCH_END","TOUCH_CANCEL","update","dt","r","Math","atan2","degree","PI","rotation"],"mappings":"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","file":"JoyStick.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\Game","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        Stick: {\n            type: cc.Node,\n            default: null,\n        },\n        ShieldBtn: {\n            type: cc.Node,\n            default: null,\n        },\n        ShieldLabel: {\n            type: cc.Label,\n            default: null,\n        },\n        ShieldPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        Player: {\n            type: cc.Node,\n            default: null,\n        },\n        Max_r: 200,\n        ShieldDuartion: 5,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    generateShield: function () {\n        if(this.player.shield <= 0){\n            return\n        }\n\n        this.player.shield--\n        this.shieldLabel.string = this.player.shield\n\n        this.newShield.active = true\n\n        setTimeout(function () {\n            this.active = false\n        }.bind(this.newShield), 1000 * this.ShieldDuartion);\n    },\n\n    start() {\n        this.shieldLabel = this.ShieldLabel.getComponent(cc.Label)\n        this.player = this.Player.getComponents(\"Player\")[0]\n        this.Speed = this.player.speed\n        this.shieldLabel.string = this.player.shield\n\n        this.Stick.x = 0;\n        this.Stick.y = 0;\n        this.dir = cc.v2(0, 0);\n\n        this.newShield = cc.instantiate(this.ShieldPrefab)\n        this.node.parent.addChild(this.newShield)\n        this.newShield.x = this.Player.x\n        this.newShield.y = this.Player.y\n\n        if (this.node.name === 'stickLeft') {\n            this.newShield.name = 'shieldLeft'\n        } else {\n            this.newShield.name = 'shieldRight'\n        }\n\n        this.newShield.active = false\n\n        this.Stick.on(cc.Node.EventType.TOUCH_START, function (e) {\n            var w_pos = e.getLocation();\n            this.pos = this.node.convertToNodeSpaceAR(w_pos);\n            var len = this.pos.mag(); //获取向量长度\n            this.dir.x = this.pos.x / len;\n            this.dir.y = this.pos.y / len;\n            if (len > this.Max_r) {\n                this.pos.x = this.Max_r * this.pos.x / len;\n                this.pos.y = this.Max_r * this.pos.y / len;\n            }\n            this.Stick.setPosition(this.pos);\n        }, this);\n\n        this.ShieldBtn.on(cc.Node.EventType.TOUCH_START, function (e) {\n            this.generateShield()\n        }, this);\n\n        this.Stick.on(cc.Node.EventType.TOUCH_MOVE, function (e) {\n            var w_pos = e.getLocation();\n            this.pos = this.node.convertToNodeSpaceAR(w_pos);\n            var len = this.pos.mag();\n            this.dir.x = this.pos.x / len;\n            this.dir.y = this.pos.y / len;\n            if (len > this.Max_r) {\n                this.pos.x = this.Max_r * this.pos.x / len;\n                this.pos.y = this.Max_r * this.pos.y / len;\n            }\n            this.Stick.setPosition(this.pos);\n        }, this);\n\n        this.Stick.on(cc.Node.EventType.TOUCH_END, function (e) {\n            this.Stick.setPosition(cc.v2(0, 0));\n            this.dir = cc.v2(0, 0);\n        }, this);\n\n        this.Stick.on(cc.Node.EventType.TOUCH_CANCEL, function (e) {\n            this.Stick.setPosition(cc.v2(0, 0));\n            this.dir = cc.v2(0, 0);\n        }, this);\n    },\n\n    update(dt) {\n        if (this.newShield !== null)\n        {\n            this.newShield.x = this.Player.x\n            this.newShield.y = this.Player.y\n        }\n\n        if (this.dir.mag() < 0.5) {\n            return\n        }\n\n        // var accelX = this.dir.x * this.Speed\n        // var accelY = this.dir.y * this.Speed\n\n\n        // if(Math.sqrt(Math.pow(this.player.speedX, 2) + Math.pow(this.player.speedY, 2)) < this.Speed)\n        // {\n           \n        //     this.player.speedX += accelX * dt;\n        //     this.player.speedY += accelY * dt;\n        // }\n\n        this.Player.x += this.Speed * this.dir.x * this.pos.mag() / (this.dir.mag() * this.Max_r)\n        this.Player.y += this.Speed * this.dir.y * this.pos.mag() / (this.dir.mag() * this.Max_r)\n\n        \n        //方向计算\n        var r = Math.atan2(this.dir.y, this.dir.x);\n        var degree = r * 180 / (Math.PI);\n        degree = 360 - degree + 90;\n        this.Player.rotation = degree;\n    },\n});"]}