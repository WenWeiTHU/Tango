{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\Game/assets\\scripts\\Game\\Game.js"],"names":["cc","Class","extends","Component","properties","Player1","type","Node","default","Player2","SupplyPrefab","Prefab","ShieldSupplyPrefab","PauseMenuPrefab","EnemyPrefab","StaticEnemyPrefab","TrackEnemyPrefab","SpinEnemyPrefab","SwingEnemyPrefab","CopterEnemyPrefab","BatteryPrefab","BulletPrefab","MapVPrefab","MapHPrefab","Explode1","AudioSource","pauseBtn","Button","MapCamera","Camera","MainCamera","Target","srcX","srcY","dstX","dstY","cameraSpeed","ratio","Width","Height","borderSize","stateChange","GameOver","schedule","zoomRatio","scheduleOnce","director","loadScene","end","onLoad","node","on","pauseScene","i","children","length","name","zIndex","sortAllChildren","cameraMove","start","child","active","pause","targetExist","grandSon","group","exist","timeID","clearTimeout","undefined","setTimeout","bind","getChildByName","Menu","instantiate","x","y","addChild","srcx","srcy","dstx","dsty","initRatio","update","dt","getComponent","Dead","win","stageName","getScene"],"mappings":"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","file":"Game.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\Game","sourcesContent":["/*\n * 游戏控制脚本\n */\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        Player1: {\n            type: cc.Node,\n            default: null,\n        },\n        Player2: {\n            type: cc.Node,\n            default: null,\n        },\n        SupplyPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        ShieldSupplyPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        PauseMenuPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        EnemyPrefab: {\n            type: cc.Prefab,\n            default: null\n        },\n        StaticEnemyPrefab: {\n            type: cc.Prefab,\n            default: null\n        },\n        TrackEnemyPrefab: {\n            type: cc.Prefab,\n            default: null\n        },\n        SpinEnemyPrefab: {\n            type: cc.Prefab,\n            default: null\n        },\n        SwingEnemyPrefab: {\n            type: cc.Prefab,\n            default: null\n        },\n        CopterEnemyPrefab: {\n            type: cc.Prefab,\n            default: null\n        },\n        BatteryPrefab: {\n            type: cc.Prefab,\n            default: null\n        },\n        BulletPrefab: {\n            type: cc.Prefab,\n            default: null\n        },\n        MapVPrefab: {\n            type: cc.Prefab,\n            default: null\n        },\n        MapHPrefab: {\n            type: cc.Prefab,\n            default: null\n        },\n        Explode1: {\n            type: cc.AudioSource,\n            default: null\n        },\n        pauseBtn: {\n            type: cc.Button,\n            default: null\n        },\n        MapCamera: {\n            type: cc.Camera,\n            default: null\n        },\n        MainCamera: {\n            type: cc.Camera,\n            default: null\n        },\n        Target: {\n            type: cc.Node,\n            default: null\n        },\n        srcX: 0,\n        srcY: 0,\n        dstX: 0,\n        dstY: 0,\n        cameraSpeed: 0,\n        ratio: 0,\n        Width: 2500,\n        Height: 2500,\n        borderSize: 35,\n        stateChange: false,\n    },\n\n    /*\n     * 游戏结束函数\n     * 功能：执行游戏结束的动作，设置定时器缩小相机焦距，\n     *      并且准备定时加载场景，将游戏状态设成结束\n     */\n    GameOver () {\n        this.schedule(() => {\n            this.MainCamera.zoomRatio -= 0.008\n        }, 0.001)\n        \n        this.scheduleOnce(()=>{\n            cc.director.loadScene(\"Transition\")\n        }, 2)\n\n        this.end = true\n    },\n\n    /*\n     * 初始化函数\n     * 功能：初始化脚本所需的设定\n     */\n    onLoad() {\n        // 设置暂停按钮的回调函数\n        this.pauseBtn.node.on(\"click\", this.pauseScene, this)\n\n        // 设置各个游戏对象的zIndex，确保显示层级的正确\n        for (var i = 0; i < this.node.children.length; ++i) {\n            switch (this.node.children[i].name) {\n                case 'player1': {\n                    this.node.children[i].zIndex = 100;\n                    break;\n                }\n                case 'player2': {\n                    this.node.children[i].zIndex = 100;\n                    break;\n                }\n                case 'stickLeft':\n                case 'stickRight': {\n                    this.node.children[i].zIndex = 101;\n                    break;\n                }\n                case 'bg': {\n                    this.node.children[i].zIndex = -100;\n                    break;\n                }\n            }\n        }\n        this.node.sortAllChildren();\n\n        // 将游戏结束状态参数设成假\n        this.end = false\n\n        // 将游戏状态改变变量设成假\n        this.stateChange = false\n\n        // 设定全景相机的移动\n        this.cameraMove(this.srcX, this.srcY, this.dstX, this.dstY, this.ratio)\n    },\n\n    start() {\n        \n    },\n\n    /*\n     * 暂停函数\n     * 功能：暂停/恢复当前场景，并设置其每一个子节点的运行状态\n     */\n    pauseScene () {\n        for (var child of this.node.children) {\n            // 遍历Canvas的每一个子节点，将其设为活跃/不活跃状态\n            switch (child.name) {\n                case 'Enemy':\n                case 'Map':\n                case 'player1':\n                case 'player2':\n                case 'bind':\n                case 'bullet': {\n                    // 普通对象直接根据暂停还是恢复来设置活跃状态\n                    child.active = this.pause\n                    break\n                }\n                case 'target': {\n                    // 将暂停前的target活跃状态记录，并在恢复时进行恢复\n                    if(!this.pause){\n                        this.targetExist = child.active\n                        child.active = false\n                    }\n                    else{\n                        child.active = this.targetExist\n                    }\n                    break\n                }\n                case 'UI': {\n                    /*\n                     * 以下函数有些繁琐，目的是为了记录护盾对象\n                     * 的存在状态，并在恢复时进行恢复。同时，由于\n                     * 护盾本身存在寿命，所以我们对恢复后的寿命给\n                     * 出一个统计的平均数——2.5s\n                     */\n                    for (var grandSon of child.children) {\n                        if (grandSon.group != 'Shield') {\n                            grandSon.active = this.pause\n                        } else {\n                            if (!this.pause) {\n                                grandSon.exist = grandSon.active\n                                grandSon.active = false\n                                if (grandSon.timeID) {\n                                    clearTimeout(grandSon.timeID)\n                                    grandSon.timeID = undefined\n                                }\n                            } else {\n                                grandSon.active = grandSon.exist\n                                grandSon.exist = false\n                                if (grandSon.active) {\n                                    if (grandSon.name == 'shieldLeft') {\n                                        grandSon.timeID = setTimeout(function(){\n                                            this.active = false\n                                        }.bind(this.node.getChildByName('UI').getChildByName('shieldLeft')), 2500)\n                                    }\n                                    else {\n                                        grandSon.timeID = setTimeout(function(){\n                                            this.active = false\n                                        }.bind(this.node.getChildByName('UI').getChildByName('shieldRight')), 2500)\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    break\n                }\n            }\n        }\n\n        // 修改场景的暂停状态\n        this.pause = this.pause ? false : true\n        if (this.pause) {\n            // 如果当前操作是要暂停此场景\n            // 则要显示一个暂停菜单\n            var Menu = cc.instantiate(this.PauseMenuPrefab)\n            Menu.x = 0\n            Menu.y = 0\n            Menu.group = 'UI'\n            this.node.getChildByName('UI').active = true\n            this.node.getChildByName(\"UI\").addChild(Menu)\n        }\n    },\n    \n    /*\n     * 相机移动功能\n     * 功能：定时缩放相机的焦距和移动相机的焦点，\n     *      使得玩家在开场前可以总览地图全局面貌\n     */\n    cameraMove (srcx, srcy, dstx, dsty, initRatio) {\n        this.MapCamera.node.x = srcx\n        this.MapCamera.node.y = srcy\n\n        var x = dstx - srcx\n        var y = dsty - srcy\n\n        this.scheduleOnce(function(){\n            this.schedule(function(){\n                if(this.MapCamera.zoomRatio > 1){\n                    this.MapCamera.node.active = false\n                }\n                else{    \n                    this.MapCamera.zoomRatio += this.cameraSpeed\n                    this.MapCamera.node.x += x * this.cameraSpeed / (1 - initRatio)\n                    this.MapCamera.node.y += y * this.cameraSpeed / (1 - initRatio)\n                }\n            }, 0.0001)\n        }, 0.8)\n    },\n    \n    // 系统调用的更新函数\n    update(dt) {\n        if(this.end){\n            // 如果检测到游戏已经结束，则停止更新\n            return\n        }\n        \n        if (this.stateChange && !this.end) {\n            // 如果检测到游戏状态发生改变（从子部件处设此变量为真），\n            // 则调用暂停函数，并恢复stateChange变量为假\n            this.pauseScene()\n            this.stateChange = false\n        }\n        if (this.Player1.getComponent('Player').Dead && !this.end) {\n            // 如果检测到玩家死亡，则游戏结束，并且立即返回\n            this.GameOver()\n            return\n        }\n        if (this.Player2.getComponent('Player').Dead && !this.end) {\n            this.GameOver()\n            return\n        }\n\n        if(this.Target.getComponent('Target').win && !this.end){\n            // 如果检测到玩家通关，则游戏结束\n            var stageName = cc.director.getScene().name\n            if(stageName === 'Stage12'){\n                // 如果当前是最后一关，则调用结束字幕\n                cc.director.loadScene('End')\n                this.end = true\n                return\n            }\n            // 否则进入正常的游戏结束函数\n            this.GameOver()\n        }\n    },\n   \n    \n});"]}