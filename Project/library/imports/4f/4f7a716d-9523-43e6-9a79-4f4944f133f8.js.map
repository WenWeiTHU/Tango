{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\Game/assets\\scripts\\Game\\Player.js"],"names":["cc","Class","extends","Component","properties","life","shield","immortalDuration","BlastPrefab","type","Prefab","default","PlayerHit","AudioSource","Death","Bonus","LifeLabel","Label","ShieldLabel","speed","onLoad","director","getCollisionManager","enabled","blastName","node","name","immortal","onCollisionEnter","other","self","group","mapCollision","enemyCollision","_name","play","blast","instantiate","parent","addChild","setPosition","x","y","animComponent","getComponent","Animation","lostLife","onCollisionStay","GameOver","setTimeout","bind","sceneName","getScene","data","sys","localStorage","setItem","JSON","stringify","loadScene","obj_map","obj_enemy","speedX","speedY","start","lifeLabel","string","shieldLabel","update","dt"],"mappings":"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","file":"Player.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\Game","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // accel: 0,       // 主角加速度\n        // speedX: 0,      // 主角X方向速度\n        // speedY: 0,      // 主角Y方向速度\n        // resistance: 0,  // 地图阻力\n        life: 3,       // 主角生命\n        shield: 3,       // 主角护盾数\n        immortalDuration: 2,\n        BlastPrefab: {\n            type:cc.Prefab,\n            default: null,\n        },\n        // 音效\n        PlayerHit:{\n            type: cc.AudioSource,\n            default: null\n        },\n        Death:{\n            type: cc.AudioSource,\n            default: null\n        },\n        Bonus:{\n            type: cc.AudioSource,\n            default: null\n        },\n        LifeLabel: {\n            type: cc.Label,\n            default: null,\n        },\n        ShieldLabel: {\n            type: cc.Label,\n            default: null,\n        },\n        speed: 5,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n    onLoad() {\n        cc.director.getCollisionManager().enabled = true\n        this.blastName = 'blast' + this.node.name[6]\n        this.immortal = false\n    },\n\n    /*\n     * 角色的碰撞事件\n     */\n    onCollisionEnter(other, self) {\n        // 获取碰撞对象的类型\n        var group = other.node.group;\n        switch (group) {\n            case 'Map': {\n                // 当碰到的是地图边界时\n                this.mapCollision(other);\n                break;\n            }\n            case 'Enemy': {\n                // 当碰到了敌人时\n                this.enemyCollision(other);\n                break;\n            }\n            case 'Supply': {\n                // 当碰到了补给\n                if(other.node._name === 'supply'){\n                    this.life++\n                }\n                else if(other.node._name === 'shieldSupply'){\n                    this.shield++\n                }\n                this.Bonus.play()\n                break\n            }\n            case 'Bullet': {\n                // 当碰到了子弹\n                var blast = cc.instantiate(this.BlastPrefab)\n                this.node.parent.addChild(blast)\n                blast.setPosition(this.node.x, this.node.y)\n                var animComponent = blast.getComponent(cc.Animation)               \n                animComponent.play(this.blastName)\n\n                this.PlayerHit.play()\n\n                this.lostLife()\n                break\n            }\n            default: {\n                // Others\n                break                \n            }\n        }\n    },\n\n    onCollisionStay(other, self) {\n        // 获取碰撞对象的类型\n        var group = other.node.group;\n        switch (group) {\n            case 'Map': {\n                // 当碰到的是地图边界时\n                this.mapCollision(other);\n                break;\n            }\n            default: {\n                // Others\n                break                \n            }\n        }\n    },\n\n    lostLife: function(){\n        if(!this.immortal){\n            this.life--\n            this.immortal = true\n            if (this.life < 0) {\n                this.GameOver()\n                return\n            }\n            setTimeout(function () {\n                this.immortal = false\n            }.bind(this), 1000 * this.immortalDuration);\n        }\n    },\n\n    GameOver: function() {\n        var sceneName = cc.director.getScene().name\n        var data = {\n            \"Stage\" : sceneName,\n            \"Win\" : false\n        }\n        cc.sys.localStorage.setItem('lastStage', JSON.stringify(data))\n        cc.director.loadScene('Transition')\n    },\n\n    /*\n     * 与地图的碰撞事件\n     */\n    mapCollision(obj_map) {\n        var name = obj_map.node._name\n        // 直接回弹\n        switch (name) {\n            case 'mapV': {\n                if(obj_map.node.x < this.node.x){\n                    this.node.x = this.node.x + this.speed + 1\n                }\n                else if(obj_map.node.x > this.node.x){\n                    this.node.x = this.node.x - this.speed - 1\n                }\n                \n                break;\n            }\n            case 'mapH': {\n                if(obj_map.node.y < this.node.y){\n                    this.node.y = this.node.y + this.speed + 1\n                }\n                else if(obj_map.node.y > this.node.y){\n                    this.node.y = this.node.y - this.speed - 1\n                }\n            }\n        }\n    },\n\n    /*\n     * 与敌人的碰撞事件\n     */\n    enemyCollision(obj_enemy) {\n        var name = obj_enemy.node.name;\n        switch (name) {\n            // 直接回弹\n            case 'battery': {\n                this.speedX = -this.speedX\n                this.speedY = -this.speedY\n                break\n            }\n            // 生命减少\n            case 'enemy':\n            case 'enemy_static':\n            case 'enemy_spin': \n            case 'enemy_swing':\n            case 'enemy_copter':\n            case 'enemy_track': {\n                var blast = cc.instantiate(this.BlastPrefab)\n                this.node.parent.addChild(blast)\n                blast.setPosition(this.node.x, this.node.y)\n    \n                var animComponent = blast.getComponent(cc.Animation)\n                animComponent.play(this.blastName)\n\n                this.PlayerHit.play()\n\n                this.lostLife()\n                break\n            }\n            \n        }\n    },\n\n    start() {\n        this.lifeLabel = this.LifeLabel.getComponent(cc.Label)\n        this.lifeLabel.string = this.life\n        this.shieldLabel = this.ShieldLabel.getComponent(cc.Label)\n        this.shieldLabel.string = this.shield\n    },\n\n    update(dt) {\n        //生命值更新\n        this.lifeLabel.string = this.life\n        this.shieldLabel.string = this.shield\n\n        // // 运动\n        // this.node.x += this.speedX * dt\n        // this.node.y += this.speedY * dt\n\n        // // 阻力\n        // if (this.speedX > this.resistance) {\n        //     this.speedX -= this.speedX * 0.01;\n        // } else if (this.speedX < -this.resistance) {\n        //     this.speedX -= this.speedX * 0.01;\n        // }\n\n        // if (this.speedY > this.resistance) {\n        //     this.speedY -= this.speedY * 0.01;\n        // } else if (this.speedY < -this.resistance) {\n        //     this.speedY -= this.speedY * 0.01;\n        // }\n    }\n});"]}