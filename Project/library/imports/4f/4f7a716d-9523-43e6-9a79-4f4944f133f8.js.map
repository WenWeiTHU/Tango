{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\Game/assets\\scripts\\Game\\Player.js"],"names":["cc","Class","extends","Component","properties","life","shield","immortalDuration","BlastPrefab","type","Prefab","default","PlayerHit","AudioSource","Death","Bonus","LifeLabel","Label","ShieldLabel","speed","Dead","onLoad","director","getCollisionManager","enabled","blastName","node","name","immortal","onCollisionEnter","other","self","group","mapCollision","enemyCollision","_name","play","blast","instantiate","parent","addChild","setPosition","x","y","animComponent","getComponent","Animation","lostLife","onCollisionStay","GameOver","setTimeout","bind","sceneName","getScene","data","sys","localStorage","setItem","JSON","stringify","obj_map","obj_enemy","speedX","speedY","start","lifeLabel","string","shieldLabel","update","dt"],"mappings":"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","file":"Player.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\Game","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // accel: 0,       // 主角加速度\n        // speedX: 0,      // 主角X方向速度\n        // speedY: 0,      // 主角Y方向速度\n        // resistance: 0,  // 地图阻力\n        life: 3,       // 主角生命\n        shield: 3,       // 主角护盾数\n        immortalDuration: 2,\n        BlastPrefab: {\n            type:cc.Prefab,\n            default: null,\n        },\n        // 音效\n        PlayerHit:{\n            type: cc.AudioSource,\n            default: null\n        },\n        Death:{\n            type: cc.AudioSource,\n            default: null\n        },\n        Bonus:{\n            type: cc.AudioSource,\n            default: null\n        },\n        LifeLabel: {\n            type: cc.Label,\n            default: null,\n        },\n        ShieldLabel: {\n            type: cc.Label,\n            default: null,\n        },\n        speed: 5,\n        Dead: false\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n    onLoad() {\n        cc.director.getCollisionManager().enabled = true\n        this.blastName = 'blast' + this.node.name[6]\n        this.immortal = false\n    },\n\n    /*\n     * 角色的碰撞事件\n     */\n    onCollisionEnter(other, self) {\n        // 获取碰撞对象的类型\n        var group = other.node.group;\n        switch (group) {\n            case 'Map': {\n                // 当碰到的是地图边界时\n                this.mapCollision(other);\n                break;\n            }\n            case 'Enemy': {\n                // 当碰到了敌人时\n                this.enemyCollision(other);\n                break;\n            }\n            case 'Supply': {\n                // 当碰到了补给\n                if(other.node._name === 'supply'){\n                    this.life++\n                }\n                else if(other.node._name === 'shieldSupply'){\n                    this.shield++\n                }\n                this.Bonus.play()\n                break\n            }\n            case 'Bullet': {\n                // 当碰到了子弹\n                var blast = cc.instantiate(this.BlastPrefab)\n                this.node.parent.addChild(blast)\n                blast.setPosition(this.node.x, this.node.y)\n                var animComponent = blast.getComponent(cc.Animation)               \n                animComponent.play(this.blastName)\n\n                this.PlayerHit.play()\n\n                this.lostLife()\n                break\n            }\n            default: {\n                // Others\n                break                \n            }\n        }\n    },\n\n    onCollisionStay(other, self) {\n        // 获取碰撞对象的类型\n        var group = other.node.group;\n        switch (group) {\n            case 'Map': {\n                // 当碰到的是地图边界时\n                this.mapCollision(other);\n                break;\n            }\n            default: {\n                // Others\n                break                \n            }\n        }\n    },\n\n    lostLife: function(){\n        if(!this.immortal){\n            this.life--\n            this.immortal = true\n            if (this.life < 0) {\n                this.GameOver()\n                return\n            }\n            setTimeout(function () {\n                this.immortal = false\n            }.bind(this), 1000 * this.immortalDuration);\n        }\n    },\n\n    GameOver: function() {\n        var sceneName = cc.director.getScene().name\n        var data = {\n            \"Stage\" : sceneName,\n            \"Win\" : false\n        }\n        cc.sys.localStorage.setItem('lastStage', JSON.stringify(data))\n        this.Dead = true\n    }, \n\n    /*\n     * 与地图的碰撞事件\n     */\n    mapCollision(obj_map) {\n        var name = obj_map.node._name\n        // 直接回弹\n        switch (name) {\n            case 'mapV': {\n                if(obj_map.node.x < this.node.x){\n                    this.node.x = this.node.x + this.speed + 1\n                }\n                else if(obj_map.node.x > this.node.x){\n                    this.node.x = this.node.x - this.speed - 1\n                }\n                \n                break;\n            }\n            case 'mapH': {\n                if(obj_map.node.y < this.node.y){\n                    this.node.y = this.node.y + this.speed + 1\n                }\n                else if(obj_map.node.y > this.node.y){\n                    this.node.y = this.node.y - this.speed - 1\n                }\n            }\n        }\n    },\n\n    /*\n     * 与敌人的碰撞事件\n     */\n    enemyCollision(obj_enemy) {\n        var name = obj_enemy.node.name;\n        switch (name) {\n            // 直接回弹\n            case 'battery': {\n                this.speedX = -this.speedX\n                this.speedY = -this.speedY\n                break\n            }\n            // 生命减少\n            case 'enemy':\n            case 'enemy_static':\n            case 'enemy_spin': \n            case 'enemy_swing':\n            case 'enemy_copter':\n            case 'enemy_track': {\n                var blast = cc.instantiate(this.BlastPrefab)\n                this.node.parent.addChild(blast)\n                blast.setPosition(this.node.x, this.node.y)\n    \n                var animComponent = blast.getComponent(cc.Animation)\n                animComponent.play(this.blastName)\n\n                this.PlayerHit.play()\n\n                this.lostLife()\n                break\n            }\n            \n        }\n    },\n\n    start() {\n        this.lifeLabel = this.LifeLabel.getComponent(cc.Label)\n        this.lifeLabel.string = this.life\n        this.shieldLabel = this.ShieldLabel.getComponent(cc.Label)\n        this.shieldLabel.string = this.shield\n    },\n\n    update(dt) {\n        //生命值更新\n        this.lifeLabel.string = this.life\n        this.shieldLabel.string = this.shield\n\n    }\n});"]}