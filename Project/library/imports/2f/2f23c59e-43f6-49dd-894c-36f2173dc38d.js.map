{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\JoyStick.js"],"names":["cc","Class","extends","Component","properties","Stick","type","Node","default","Player","Max_r","Speed","MaxSpeed","start","x","y","dir","v2","on","EventType","TOUCH_START","e","w_pos","getLocation","pos","node","convertToNodeSpaceAR","len","mag","setPosition","TOUCH_MOVE","TOUCH_END","TOUCH_CANCEL","update","dt","accelX","accelY","player","getComponents","Math","sqrt","pow","speedX","speedY","r","atan2","degree","PI","rotation"],"mappings":"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","file":"JoyStick.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        Stick: {\r\n            type: cc.Node,\r\n            default: null,\r\n        },\r\n        Player:{\r\n            type: cc.Node,\r\n            default: null,\r\n        },\r\n        Max_r: 200,\r\n        Speed: 200,\r\n        MaxSpeed: 200\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {},\r\n\r\n    start() {\r\n        this.Stick.x = 0;\r\n        this.Stick.y = 0;\r\n        this.dir = cc.v2(0,0);\r\n\r\n\r\n        this.Stick.on(cc.Node.EventType.TOUCH_START, function (e) {\r\n            var w_pos = e.getLocation();\r\n            var pos = this.node.convertToNodeSpaceAR(w_pos);\r\n            var len = pos.mag(); //获取向量长度\r\n            this.dir.x = pos.x / len;\r\n            this.dir.y = pos.y / len;\r\n            if (len > this.Max_r) {\r\n                pos.x = this.Max_r * pos.x / len;\r\n                pos.y = this.Max_r * pos.y / len;\r\n            }\r\n            this.Stick.setPosition(pos);\r\n        }, this);\r\n\r\n        this.Stick.on(cc.Node.EventType.TOUCH_MOVE, function (e) {\r\n            var w_pos = e.getLocation();\r\n            var pos = this.node.convertToNodeSpaceAR(w_pos);\r\n            var len = pos.mag();\r\n            this.dir.x = pos.x / len;\r\n            this.dir.y = pos.y / len;\r\n            if (len > this.Max_r) {\r\n                pos.x = this.Max_r * pos.x / len;\r\n                pos.y = this.Max_r * pos.y / len;\r\n            }\r\n            this.Stick.setPosition(pos);\r\n        }, this);\r\n\r\n        this.Stick.on(cc.Node.EventType.TOUCH_END, function (e) {\r\n            this.Stick.setPosition(cc.v2(0, 0));\r\n            this.dir = cc.v2(0, 0);\r\n        }, this);\r\n\r\n        this.Stick.on(cc.Node.EventType.TOUCH_CANCEL, function (e) {\r\n            this.Stick.setPosition(cc.v2(0, 0));\r\n            this.dir = cc.v2(0, 0);\r\n        }, this);\r\n    },\r\n\r\n    update (dt) {\r\n        if (this.dir.mag() < 0.5) {\r\n            return;\r\n        }\r\n\r\n        // var vx = this.dir.x * this.Speed;\r\n        // var vy = this.dir.y * this.Speed;\r\n\r\n        // var sx = vx * dt;\r\n        // var sy = vy * dt;\r\n        // //移动\r\n        // this.Player.x += sx;\r\n        // this.Player.y += sy;\r\n        var accelX = this.dir.x * this.Speed;\r\n        var accelY = this.dir.y * this.Speed;\r\n        var player = this.Player.getComponents(\"Player\")[0];\r\n        if(Math.sqrt(Math.pow(player.speedX, 2) + Math.pow(player.speedY, 2)) < this.Speed)\r\n        {\r\n           \r\n            player.speedX += accelX * dt;\r\n            player.speedY += accelY * dt;\r\n        }\r\n\r\n        //方向计算\r\n        var r = Math.atan2(this.dir.y, this.dir.x);\r\n        var degree = r * 180 / (Math.PI);\r\n        degree = 360 - degree + 90;\r\n        this.Player.rotation = degree;\r\n    },\r\n});"]}