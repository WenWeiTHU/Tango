{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\Game/assets\\scripts\\Game\\JoyStick.js"],"names":["cc","Class","extends","Component","properties","Stick","type","Node","default","ShieldBtn","ShieldLabel","Label","ShieldPrefab","Prefab","Player","Max_r","Speed","ShieldDuartion","generateShield","player","shield","shieldLabel","string","newShield","active","setTimeout","bind","start","getComponent","getComponents","x","y","dir","v2","instantiate","node","parent","addChild","on","EventType","TOUCH_START","e","w_pos","getLocation","pos","convertToNodeSpaceAR","len","mag","setPosition","TOUCH_MOVE","TOUCH_END","TOUCH_CANCEL","update","dt","move","accelX","accelY","Math","sqrt","pow","speedX","speedY","r","atan2","degree","PI","rotation"],"mappings":"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","file":"JoyStick.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\Game","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        Stick: {\r\n            type: cc.Node,\r\n            default: null,\r\n        },\r\n        ShieldBtn: {\r\n            type: cc.Node,\r\n            default: null,\r\n        },\r\n        ShieldLabel: {\r\n            type: cc.Label,\r\n            default: null,\r\n        },\r\n        ShieldPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        Player: {\r\n            type: cc.Node,\r\n            default: null,\r\n        },\r\n        Max_r: 200,\r\n        Speed: 600,\r\n        ShieldDuartion: 5\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {},\r\n\r\n    generateShield: function () {\r\n        if(this.player.shield <= 0){\r\n            return\r\n        }\r\n\r\n        this.player.shield--\r\n        this.shieldLabel.string = this.player.shield\r\n\r\n        this.newShield.active = true\r\n\r\n        setTimeout(function () {\r\n            this.active = false\r\n        }.bind(this.newShield), 1000 * this.ShieldDuartion);\r\n    },\r\n\r\n    start() {\r\n        this.shieldLabel = this.ShieldLabel.getComponent(cc.Label)\r\n        this.player = this.Player.getComponents(\"Player\")[0]\r\n        this.shieldLabel.string = this.player.shield\r\n\r\n        \r\n        this.Stick.x = 0;\r\n        this.Stick.y = 0;\r\n        this.dir = cc.v2(0, 0);\r\n\r\n        this.newShield = cc.instantiate(this.ShieldPrefab)\r\n        this.node.parent.addChild(this.newShield)\r\n        this.newShield.x = this.Player.x\r\n        this.newShield.y = this.Player.y\r\n\r\n        this.newShield.active = false\r\n\r\n        this.Stick.on(cc.Node.EventType.TOUCH_START, function (e) {\r\n            var w_pos = e.getLocation();\r\n            var pos = this.node.convertToNodeSpaceAR(w_pos);\r\n            var len = pos.mag(); //获取向量长度\r\n            this.dir.x = pos.x / len;\r\n            this.dir.y = pos.y / len;\r\n            if (len > this.Max_r) {\r\n                pos.x = this.Max_r * pos.x / len;\r\n                pos.y = this.Max_r * pos.y / len;\r\n            }\r\n            this.Stick.setPosition(pos);\r\n        }, this);\r\n\r\n        this.ShieldBtn.on(cc.Node.EventType.TOUCH_START, function (e) {\r\n            this.generateShield()\r\n        }, this);\r\n\r\n        this.Stick.on(cc.Node.EventType.TOUCH_MOVE, function (e) {\r\n            var w_pos = e.getLocation();\r\n            var pos = this.node.convertToNodeSpaceAR(w_pos);\r\n            var len = pos.mag();\r\n            this.dir.x = pos.x / len;\r\n            this.dir.y = pos.y / len;\r\n            if (len > this.Max_r) {\r\n                pos.x = this.Max_r * pos.x / len;\r\n                pos.y = this.Max_r * pos.y / len;\r\n            }\r\n            this.Stick.setPosition(pos);\r\n        }, this);\r\n\r\n        this.Stick.on(cc.Node.EventType.TOUCH_END, function (e) {\r\n            this.Stick.setPosition(cc.v2(0, 0));\r\n            this.dir = cc.v2(0, 0);\r\n        }, this);\r\n\r\n        this.Stick.on(cc.Node.EventType.TOUCH_CANCEL, function (e) {\r\n            this.Stick.setPosition(cc.v2(0, 0));\r\n            this.dir = cc.v2(0, 0);\r\n        }, this);\r\n    },\r\n\r\n    update(dt) {\r\n        if (this.newShield !== null)\r\n        {\r\n            this.newShield.x = this.Player.x\r\n            this.newShield.y = this.Player.y\r\n        }\r\n\r\n        var Player = this.Player.getComponent('Player')\r\n\r\n        if (this.dir.mag() < 0.5) {\r\n            debugger;\r\n            Player.move = false\r\n            return\r\n        }\r\n        Player.move = true\r\n        \r\n\r\n        var accelX = this.dir.x * this.Speed\r\n        var accelY = this.dir.y * this.Speed\r\n\r\n\r\n        if(Math.sqrt(Math.pow(this.player.speedX, 2) + Math.pow(this.player.speedY, 2)) < this.Speed)\r\n        {\r\n           \r\n            this.player.speedX += accelX * dt;\r\n            this.player.speedY += accelY * dt;\r\n        }\r\n        \r\n        //方向计算\r\n        var r = Math.atan2(this.dir.y, this.dir.x);\r\n        var degree = r * 180 / (Math.PI);\r\n        degree = 360 - degree + 90;\r\n        this.Player.rotation = degree;\r\n    },\r\n});"]}