{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\Game/assets\\scripts\\Game\\Battery.js"],"names":["cc","Class","extends","Component","properties","rotationUpdate","bulletSpeed","shootNum","Player1","type","Node","default","Player2","BulletPrefab","Prefab","Orbit","AudioSource","shootTime","onLoad","director","getCollisionManager","enabled","start","target","Math","random","schedule","createBullet","play","dir","v2","x","node","y","newBullet","instantiate","bulletSetting","getComponent","r","atan2","degree","PI","rotation","zIndex","direction","speed","parent","addChild","i","cos","sin","sortAllChildren","update","dt"],"mappings":"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","file":"Battery.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\Game","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        rotationUpdate: 0,\n        bulletSpeed: 0,\n        shootNum: 2,\n        Player1: {\n            type: cc.Node,\n            default: null\n        },\n        Player2: {\n            type: cc.Node,\n            default: null\n        },\n        BulletPrefab: {\n            type: cc.Prefab,\n            default: null\n        },\n        Orbit:{\n            type: cc.AudioSource,\n            default: null\n        },\n        shootTime: 2\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n        cc.director.getCollisionManager().enabled = true;\n    },\n\n    start() {\n        this.target = Math.random() > 0.5 ? this.Player1 : this.Player2;\n        this.schedule(this.createBullet, this.shootTime);\n    },\n\n    /*\n     * 产生新子弹的函数\n     */\n    createBullet() {\n        this.Orbit.play()\n        \n        // 从炮台到目标位置的向量\n        var dir = cc.v2(this.target.x - this.node.x, this.target.y - this.node.y);\n\n        // 构造新子弹，并设置参数\n        var newBullet = cc.instantiate(this.BulletPrefab);\n        var bulletSetting = newBullet.getComponent(\"Bullet\");\n\n        var r = Math.atan2(this.dir.y, this.dir.x);\n        var degree = r * 180 / (Math.PI);\n        newBullet.rotation = 450 - degree;\n\n        newBullet.x = this.node.x\n        newBullet.y = this.node.y\n        newBullet.zIndex = -1;\n        bulletSetting.direction = dir;\n        bulletSetting.speed = this.bulletSpeed;\n        this.node.parent.addChild(newBullet);\n\n        for (let i = 1; i < this.shootNum; i++) {\n            let newBullet = cc.instantiate(this.BulletPrefab)\n            let bulletSetting = newBullet.getComponent(\"Bullet\")\n            let r = Math.atan2(this.dir.y, this.dir.x);\n            let degree = r * 180 / (Math.PI) + 5 * i;\n            newBullet.rotation = 450 - degree;\n            newBullet.x = this.node.x\n            newBullet.y = this.node.y\n            newBullet.zIndex = -1;\n\n            bulletSetting.direction = cc.v2(Math.cos(degree*Math.PI/180), Math.sin(degree*Math.PI/180));\n            bulletSetting.speed = this.bulletSpeed;\n            this.node.parent.addChild(newBullet);\n        }\n\n        for (let i = 1; i < this.shootNum; i++) {\n            let newBullet = cc.instantiate(this.BulletPrefab)\n            let bulletSetting = newBullet.getComponent(\"Bullet\")\n            let r = Math.atan2(this.dir.y, this.dir.x);\n            let degree = r * 180 / (Math.PI) - 5 * i;\n            newBullet.rotation = 450 - degree;\n            newBullet.x = this.node.x\n            newBullet.y = this.node.y\n            newBullet.zIndex = -1;\n\n            bulletSetting.direction = cc.v2(Math.cos(degree*Math.PI/180), Math.sin(degree*Math.PI/180));\n            bulletSetting.speed = this.bulletSpeed;\n            this.node.parent.addChild(newBullet);\n        }\n\n        this.node.parent.sortAllChildren();\n    },\n\n    update(dt) {\n        this.dir = cc.v2(this.target.x - this.node.x, this.target.y - this.node.y);\n        var r = Math.atan2(this.dir.y, this.dir.x);\n        var degree = r * 180 / (Math.PI);\n        degree = 360 - degree + 90;\n        this.node.rotation = degree;\n    },\n});"]}